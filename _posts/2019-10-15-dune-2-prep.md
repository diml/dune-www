---
layout: blog
title: Preparing for Dune 2.0.0
author: dimenix
tags: [ocaml, dune, jbuilder]
picture: /assets/imgs/dune-2.0.0.png
discuss: https://discuss.ocaml.org/t/dune-2-0-0-coming-soon/4102
---

It seems that we have establish a pattern: Dune delivers a continuous
stream of updates via monthly releases while major releases take a few
months. Among other things, we have been preparing Dune 2.0.0 for the
past few months and we plan to release it on the 28th of
October 2019. At this point, we are very eager to get Dune 2.0.0 out
of the door and resume our usual fast release cycle!

In this post, we'll recap the major changes in Dune 2.0.0 to help
users make the most of it.

As usual, this release will not break the build of any existing
released projects, except maybe for very few exceptions. New features
will appear in Dune 2.0.0. Those that affect the language inside
`dune` files will be unlocked by changing the first line of your
`dune-project` file to `(lang dune 2.0.0)`. Taking this action might
also require you to change a couple of things in your `dune`
files. Indeed, we took the opportunity of this new major release to
re-think and improve a few aspects of the language.

Making `dune` a pure binary
---------------------------

We would like to make `dune` a pure tool that one can install once and
for all instead of a tool tied to the current version of OCaml. This
is already the case for the `dune` binary itself; one can build a
`dune` binary with a given version of OCaml, drop the resulting binary
anywhere in a completly different setup with a different version of
the compiler and it will just work. `dune` is able to recognise its
environment and adapt to it at runtime.

However, up to now we have been distributing the `dune.configurator`
library alongside `dune`, and because of the way things work in OCaml,
that mean that the `dune` package is tied to one particular version of
OCaml.

To detach the `dune` package from a particular compilre, one major
change is Dune 2.0.0 is that the `dune.configurator` library has now
been extracted into a separate `dune-configurator` package. The old
`dune.configurator` name still exist for backward compatibility,
however one must still add a dependency on `dune-configurator` in
their package description. This has already been done inside the opam
repository.

On this subject, one very handy feature of Dune 2.0.0 is the ability
to add a redirection from an old deprecated library name to a new
one. Indeed, Dune forces library names to start with the package name
which can make it difficult to port projects to Dune. For instance,
historically the `menhir` package has been installing a toplevel
`menhirLib` library. In the Dune port, `menhirLib` has been renamed
`menhir.lib` and a pointer has been added from the old name via:

```scheme
(deprecated_library_name
 (old_public_name menhirLib)
 (new_public_name menhir.lib))
```

Preparing for the shared cache
------------------------------

Some of you have already noticed, but in the master of dune there is
support for a shared cache. So what is a shared cache exactly? In
normal operation, a build system shares built artefacts between
runs. This is what gives us incremental compilation: we don't rebuild
things that haven't changed because we share the result with the
previous run.

A global shared cache increasing sharing not only from one built to
another, but between workspaces as well. If you are a user of opam
local switches, this should eventually greatly improve your workflow
and in particular setting up a new local switch will become much faster.
